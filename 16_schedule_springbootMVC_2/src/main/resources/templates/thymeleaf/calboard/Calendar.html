<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{thymeleaf/layouts/layout}">
<head>
<meta charset="UTF-8">
<title></title>
<style type="text/css">
	.cal{width:100%;}
	.cal #thead > div, .cal #tbody > div{display: inline-block; width: 140px;}
	.cal #tbody > div{
			height: 120px; 
			vertical-align: top; 
			border-top:1px solid gray;
			position: relative;
	}
	#ctitle{text-align: center;}
	.pen{ width:20px; height:20px;}
	.d{
		font-weight:bold;
		font-size:17px;
	}
	#tbody > div > p{background-color:red; color:yellow;}
	.cp{
		position: absolute;
		left: 20px;
		top: -40px;
		width:40px;
		height:40px;
		border-radius: 20px 20px 20px 1px;
		color: yellow;
		background-color: red;
		line-height: 40px;
		text-align: center;
		font-weight: bold;
	}
</style>
<script type="text/javascript">
	$(function(){
		$(".d").hover(function(){
			//controllerë¡œ ì „ë‹¬í•  íŒŒë¼ë¯¸í„° yyyyMMë¥¼ êµ¬í•¨
			var aDate = $(this); // í˜„ì¬ ë§ˆìš°ìŠ¤ê°€ ì˜¬ë¼ê°„ a íƒœê·¸(.d) êµ¬í•¨
			var year=$(".y").text().trim(); // ë…„ë„
			var month=$(".m").text().trim(); // ì›”
			var date = aDate.text().trim(); // ì¼
			var yyyyMMdd = year+(month.length<2?"0"+month:month)
										+(date.length<2?"0"+date:date); //8ìë¦¬ ë§Œë“¤ê¸°
//			alert(yyyyMMdd+"ì•„ë‹ˆì•¼ì‘ì•„ë‹ˆì•¼");
			if(aDate.nextAll("p").length>0){
				$.ajax({
					url:"/schedule/calCountAjax",
					method:"get",
					data:{"yyyyMMdd":yyyyMMdd}, // ì„œë²„ë¡œ ì „ë‹¬í•˜ëŠ” ê°’
					dataType:"json", // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„° íƒ€ì…
					async:false, // ajax() ë©”ì„œë“œê°€ ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ë˜ëŠ”ê²ƒì„ ë§‰ìŒ : false ì„¤ì •
					success:function(data){ // ì„±ê³µí•˜ë©´ ë°ì´í„°ê°€ data ë³€ìˆ˜ì— ì €ì¥ë¨
	//					alert(data.count+"ì‘ì•„ë‹ˆì•„ë‹ˆì•¼");
						aDate.after("<div class='cp'>"+data.count+"</div>");
					},
					error:function(){
						alert("í†µì‹ ì‹¤íŒ¨ã…‹");
					}
				});
			}
		}, function(){
			$(".cp").remove();
		});
	});
</script>
</head>
<body>
<div layout:fragment="content">
	<div id="container">
		<h1>ì¼ì •ê´€ë¦¬[ë‹¬ë ¥ë³´ê¸°]</h1>
		<div class="cal">
			<div id="ctitle">
				<a th:href="@{/schedule/calendar(year=${calMap.year-1},month=${calMap.month})}">ğŸ™ˆ</a>
				<a th:href="@{/schedule/calendar(year=${calMap.year},month=${calMap.month-1})}">ğŸ™‰</a>
				<span class="y" th:text="${calMap.year}"></span>
				<span>ë…„</span>
				<span class="m" th:text="${calMap.month}"></span>
				<span>ì›”</span>
				<a th:href="@{/schedule/calendar(year=${calMap.year},month=${calMap.month+1})}">ğŸ™‰</a>
				<a th:href="@{/schedule/calendar(year=${calMap.year+1},month=${calMap.month})}">ğŸ™ˆ</a>
			</div>
			<div id="thead">
				<div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
			</div>
			<div id="tbody">
				<th:block th:if="${calMap.dayOfWeek>1}">
					<div th:each="num:${#numbers.sequence(1,calMap.dayOfWeek-1)}">&nbsp;</div>
				</th:block>
				<th:block th:each="i:${#numbers.sequence(1,calMap.lastDay)}">
					<div>
						<a class="d" th:text="${i}" th:style="'color:'+${@util.fontColor(i, calMap.dayOfWeek)}"
							th:href="@{/schedule/calBoardList(year=${calMap.year},month=${calMap.month},date=${i})}"
						></a>
						<a th:href="@{/schedule/addCalBoardForm(year=${calMap.year},month=${calMap.month},date=${i})}">
							<img class="pen" th:src="@{/img/pen.png}"  />
						</a>
						[(${@util.getCalViewList(i,clist)})]
					</div>
				</th:block>
			</div>
		</div>
	</div>
</div>
</body>
</html>














